"use strict";window.apiCall=function(e,n,t,i,o){for(var r in o=o||i||t,i=i||t,4===arguments.length&&(i=void 0),3===arguments.length&&(t=void 0,i=void 0),t=t||{})null==t[r]&&delete t[r];var a=n.search("\\?")>=0?"&":"?";$.ajax({accepts:"application/json",contentType:"application/json",data:i?JSON.stringify(i):void 0,dataType:"json",error:function(e,n,t){var i={error_code:"ajax_error",error_thrown:t,jqXHR:e,text_status:n};try{e.responseText&&(i=$.parseJSON(e.responseText))}catch(e){i=e}return LOG("apiCall error",i),"function"==typeof o?o(i):void 0},success:function(n){if("success"===n.status){var t=void 0;return n.next_url&&(t=function(t){return apiCall(e,n.next_url,{},o)}),"function"==typeof o?o(void 0,n.result,t):void 0}return"function"==typeof o?o(i):void 0},type:e,url:"".concat(n).concat(a).concat($.param(t))})},window.LOG=function(){var e;return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log?(e=console).log.apply(e,arguments):void 0},window.initCommon=function(){initLoadingButton(),initConfirmButton(),initPasswordShowButton(),initTime(),initAnnouncement(),initRowLink()},window.initLoadingButton=function(){return $("body").on("click",".btn-loading",function(){$(this).button("loading")})},window.initConfirmButton=function(){return $("body").on("click",".btn-confirm",function(){confirm($(this).data("message")||"Are you sure?")||event.preventDefault()})},window.initPasswordShowButton=function(){return $("body").on("click",".btn-password-show",function(){var e=$($(this).data("target"));e.focus(),$(this).hasClass("active")?e.attr("type","password"):e.attr("type","text")})},window.initTime=function(){if($("time").length>0){moment.lang(LOCALE);!function e(){$("time[datetime]").each(function(){var e=moment.utc($(this).attr("datetime"));moment().diff(e,"days")>25?$(this).text(e.local().format("YYYY-MM-DD")):$(this).text(e.fromNow()),$(this).attr("title",e.local().format("dddd, MMMM Do YYYY, HH:mm:ss Z"))}),setTimeout(e,45e3)}()}},window.initAnnouncement=function(){$(".alert-announcement button.close").click(function(){return"undefined"!=typeof sessionStorage&&null!==sessionStorage?sessionStorage.setItem("closedAnnouncement",$(".alert-announcement").html()):void 0}),("undefined"!=typeof sessionStorage&&null!==sessionStorage?sessionStorage.getItem("closedAnnouncement"):void 0)!==$(".alert-announcement").html()&&$(".alert-announcement").show()},window.initRowLink=function(){$("body").on("click",".row-link",function(){window.location.href=$(this).data("href")}),$("body").on("click",".not-link",function(e){return e.stopPropagation()})},window.clearNotifications=function(){return $("#notifications").empty()},window.showNotification=function(e,n){null==n&&(n="warning"),clearNotifications(),e&&$("#notifications").append('<div class="alert alert-dismissable alert-'.concat(n,'"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>').concat(e,"</div>"))},$(function(){initCommon(),$("html.auth").each(function(){initAuth()}),$("html.user-list").each(function(){initUserList()}),$("html.user-merge").each(function(){initUserMerge()})}),window.initAuth=function(){$(".remember").change(function(){var e,n=$(".btn-social").toArray().concat($(".btn-social-icon").toArray()),t=$(".remember input").is(":checked"),i=!0,o=!1,r=void 0;try{for(var a,s=n[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){var c=a.value;e=$(c).prop("href"),t?$(c).prop("href","".concat(e,"&remember=true")):$(c).prop("href",e.replace("&remember=true",""))}}catch(e){o=!0,r=e}finally{try{i||null==s.return||s.return()}finally{if(o)throw r}}}),$(".remember").change()},window.initUserList=function(){initUserSelections(),initUserDeleteBtn(),initUserMergeBtn()};var initUserSelections=function(){$("input[name=user_db]").each(function(){userSelectRow($(this))}),$("#select-all").change(function(){$("input[name=user_db]").prop("checked",$(this).is(":checked")),$("input[name=user_db]").each(function(){userSelectRow($(this))})}),$("input[name=user_db]").change(function(){userSelectRow($(this))})},userSelectRow=function(e){updateUserSelections(),$("input[name=user_db]").each(function(){var n=e.val();$("#".concat(n)).toggleClass("warning",e.is(":checked"))})},updateUserSelections=function(){var e=$("input[name=user_db]:checked").length;$("#user-actions").toggleClass("hidden",0===e),$("#user-merge").toggleClass("hidden",e<2),0===e?($("#select-all").prop("indeterminate",!1),$("#select-all").prop("checked",!1)):0===$("input[name=user_db]:not(:checked)").length?($("#select-all").prop("indeterminate",!1),$("#select-all").prop("checked",!0)):$("#select-all").prop("indeterminate",!0)},initUserDeleteBtn=function(){return $("#user-delete").click(function(e){clearNotifications(),e.preventDefault();var n=$(this).data("confirm").replace("{users}",$("input[name=user_db]:checked").length);if(confirm(n)){var t=[];$("input[name=user_db]:checked").each(function(){$(this).attr("disabled",!0),t.push($(this).val())});var i=$(this).data("api-url"),o=$(this).data("success"),r=$(this).data("error");apiCall("DELETE",i,{user_keys:t.join(",")},function(e,n){if(e)return $("input[name=user_db]:disabled").removeAttr("disabled"),void showNotification(r.replace("{users}",t.length),"danger");$("#".concat(n.join(", #"))).fadeOut(function(){$(this).remove(),updateUserSelections(),showNotification(o.replace("{users}",t.length),"success")})})}})};window.initUserMerge=function(){var e=$("#user_keys").val(),n=$(".api-url").data("api-url");apiCall("GET",n,{user_keys:e},function(e,n){e?LOG("Something went terribly wrong"):(window.user_dbs=n,$("input[name=user_db]").removeAttr("disabled"))}),$("input[name=user_db]").change(function(e){var n=$(e.currentTarget).val();selectDefaultUser(n)})};var selectDefaultUser=function(e){$(".user-row").removeClass("success").addClass("danger"),$("#".concat(e)).removeClass("danger").addClass("success");var n=!0,t=!1,i=void 0;try{for(var o,r=user_dbs[Symbol.iterator]();!(n=(o=r.next()).done);n=!0){var a=o.value;if(e===a.key){$("input[name=user_key]").val(a.key),$("input[name=username]").val(a.username),$("input[name=name]").val(a.name),$("input[name=email]").val(a.email);break}}}catch(e){t=!0,i=e}finally{try{n||null==r.return||r.return()}finally{if(t)throw i}}},initUserMergeBtn=function(){return $("#user-merge").click(function(e){e.preventDefault();var n=[];$("input[name=user_db]:checked").each(function(){n.push($(this).val())});var t=$(this).data("user-merge-url");window.location.href="".concat(t,"?user_keys=").concat(n.join(","))})};